<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ - ì‹¤ì œ íŒŒì¼ ì§€ì›</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 50;
        }
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6 var(--progress), #e5e7eb var(--progress));
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        .file-drop-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .file-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            background: white;
        }
        .file-item:hover {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- í—¤ë” -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-gray-900">í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        ì €ì¥ëœ ë°ì´í„°: <span id="storageInfo">ê³„ì‚° ì¤‘...</span>
                    </div>
                    <button id="exportBtn" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                        ğŸ’¾ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                    </button>
                    <input type="file" id="importFile" accept=".json" class="hidden">
                    <button id="importBtn" class="px-3 py-1 bg-purple-600 text-white rounded text-sm hover:bg-purple-700">
                        ğŸ“ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    </button>
                    <button id="dashboardBtn" class="flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white">
                        ğŸ“Š ëŒ€ì‹œë³´ë“œ
                    </button>
                    <button id="projectsBtn" class="flex items-center px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">
                        ğŸ“‹ í”„ë¡œì íŠ¸ ëª©ë¡
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- ëŒ€ì‹œë³´ë“œ ë·° -->
        <div id="dashboardView" class="space-y-6">
            <!-- ì›”ë³„ ì„ íƒ -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-900">ì›”ë³„ ëŒ€ì‹œë³´ë“œ</h2>
                    <div class="flex space-x-4">
                        <select id="yearSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="2025" selected>2025ë…„</option>
                            <option value="2026">2026ë…„</option>
                            <option value="2027">2027ë…„</option>
                        </select>
                        <select id="monthSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="0">1ì›”</option>
                            <option value="1">2ì›”</option>
                            <option value="2">3ì›”</option>
                            <option value="3">4ì›”</option>
                            <option value="4">5ì›”</option>
                            <option value="5">6ì›”</option>
                            <option value="6">7ì›”</option>
                            <option value="7">8ì›”</option>
                            <option value="8" selected>9ì›”</option>
                            <option value="9">10ì›”</option>
                            <option value="10">11ì›”</option>
                            <option value="11">12ì›”</option>
                        </select>
                    </div>
                </div>
                
                <!-- ì£¼ìš” ì§€í‘œ -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="text-3xl">ğŸ“…</div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-600">ì´ í”„ë¡œì íŠ¸</p>
                                <p id="totalProjects" class="text-2xl font-bold text-blue-900">3</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="text-3xl">âœ…</div>
                            <div class="ml-3">
                                <p class="text-sm text-green-600">ì™„ë£Œ</p>
                                <p id="completedProjects" class="text-2xl font-bold text-green-900">1</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="text-3xl">ğŸ•</div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-600">ì§„í–‰ì¤‘</p>
                                <p id="inProgressProjects" class="text-2xl font-bold text-yellow-900">1</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="text-3xl">âš¡</div>
                            <div class="ml-3">
                                <p class="text-sm text-purple-600">í‰ê·  ì§„í–‰ë¥ </p>
                                <p id="avgProgress" class="text-2xl font-bold text-purple-900">62%</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-indigo-50 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="text-3xl">ğŸ“</div>
                            <div class="ml-3">
                                <p class="text-sm text-indigo-600">ì´ íŒŒì¼</p>
                                <p id="totalFiles" class="text-2xl font-bold text-indigo-900">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬ -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">ì¹´í…Œê³ ë¦¬ë³„ í”„ë¡œì íŠ¸ ë¶„í¬</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- ìƒíƒœë³„ ë¶„í¬ -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">ìƒíƒœë³„ í”„ë¡œì íŠ¸ ë¶„í¬</h3>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- í”„ë¡œì íŠ¸ ì§„í–‰ë„ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">í”„ë¡œì íŠ¸ ì§„í–‰ë„</h3>
                <div id="progressList" class="space-y-4">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>

        <!-- í”„ë¡œì íŠ¸ ëª©ë¡ ë·° -->
        <div id="projectsView" class="space-y-6 hidden">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-900">í”„ë¡œì íŠ¸ ëª©ë¡</h2>
                <button id="addProjectBtn" class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    â• ìƒˆ í”„ë¡œì íŠ¸
                </button>
            </div>

            <!-- í”„ë¡œì íŠ¸ ëª©ë¡ -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í”„ë¡œì íŠ¸ëª…</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì¹´í…Œê³ ë¦¬</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì§„í–‰ë„</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê¸°ê°„</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">íŒŒì¼</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- í”„ë¡œì íŠ¸ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
    <div id="projectModal" class="modal-overlay hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <h3 id="modalTitle" class="text-lg font-bold text-gray-900 mb-4">ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">í”„ë¡œì íŠ¸ëª…</label>
                    <input id="projectName" type="text" class="w-full rounded-md border-gray-300 shadow-sm" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬</label>
                    <select id="projectCategory" class="w-full rounded-md border-gray-300 shadow-sm">
                        <option value="ì†”ë£¨ì…˜">ì†”ë£¨ì…˜</option>
                        <option value="ì»¨ì„¤íŒ…">ì»¨ì„¤íŒ…</option>
                        <option value="ê°•ì˜">ê°•ì˜</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ìƒíƒœ</label>
                    <select id="projectStatus" class="w-full rounded-md border-gray-300 shadow-sm">
                        <option value="ê³„íš">ê³„íš</option>
                        <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                        <option value="ë³´ë¥˜">ë³´ë¥˜</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì§„í–‰ë„ (<span id="progressValue">0</span>%)</label>
                    <input id="projectProgress" type="range" min="0" max="100" value="0" class="w-full">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œì‘ì¼</label>
                    <input id="projectStartDate" type="date" class="w-full rounded-md border-gray-300 shadow-sm" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì¢…ë£Œì¼</label>
                    <input id="projectEndDate" type="date" class="w-full rounded-md border-gray-300 shadow-sm" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì„¤ëª…</label>
                    <textarea id="projectDescription" class="w-full rounded-md border-gray-300 shadow-sm" rows="3"></textarea>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button id="cancelBtn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">ì·¨ì†Œ</button>
                    <button id="saveBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- íŒŒì¼ ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="fileModal" class="modal-overlay hidden">
        <div class="relative top-10 mx-auto p-5 border w-5/6 max-w-5xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 id="fileModalTitle" class="text-xl font-bold text-gray-900">íŒŒì¼ ê´€ë¦¬</h3>
                <button id="closeFileModal" class="text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
            </div>

            <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mb-3">íŒŒì¼ ì—…ë¡œë“œ</h4>
                
                <!-- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ -->
                <div id="fileDropZone" class="file-drop-zone mb-4">
                    <div class="text-4xl mb-2">ğŸ“</div>
                    <p class="text-lg font-medium text-gray-700">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</p>
                    <p class="text-sm text-gray-500 mt-1">ìµœëŒ€ 10MB, ëª¨ë“  íŒŒì¼ í˜•ì‹ ì§€ì›</p>
                    <input type="file" id="fileInput" class="hidden" multiple>
                </div>

                <!-- í´ë” ì„ íƒ -->
                <div class="flex items-center space-x-3">
                    <label class="text-sm font-medium text-gray-700">í´ë”:</label>
                    <select id="uploadFileFolder" class="rounded-md border-gray-300 shadow-sm">
                        <option value="ë¬¸ì„œ">ë¬¸ì„œ</option>
                        <option value="ë””ìì¸">ë””ìì¸</option>
                        <option value="ë¶„ì„">ë¶„ì„</option>
                        <option value="ê°•ì˜ìë£Œ">ê°•ì˜ìë£Œ</option>
                        <option value="ì†ŒìŠ¤ì½”ë“œ">ì†ŒìŠ¤ì½”ë“œ</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                    <button id="uploadBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50" disabled>
                        ğŸ“¤ ì—…ë¡œë“œ
                    </button>
                </div>
            </div>

            <!-- í´ë” í•„í„° -->
            <div class="mb-4">
                <div id="folderFilters" class="flex space-x-2 flex-wrap">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>

            <!-- íŒŒì¼ ëª©ë¡ -->
            <div class="bg-white border rounded-lg">
                <div class="px-4 py-3 border-b bg-gray-50 flex justify-between items-center">
                    <h4 class="text-lg font-semibold text-gray-700">íŒŒì¼ ëª©ë¡ (<span id="fileCount">0</span>ê°œ)</h4>
                    <div class="text-sm text-gray-600">
                        ì´ ìš©ëŸ‰: <span id="totalFileSize">0 KB</span>
                    </div>
                </div>
                
                <div id="fileList" class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>

            <div class="mt-6 flex justify-end">
                <button id="closeFileModalBtn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ - LocalStorage ì‚¬ìš©
        let projects = [];
        let currentView = 'dashboard';
        let selectedMonth = 8; // 9ì›” (0-based)
        let selectedYear = 2025;
        let editingProject = null;
        let selectedProject = null;
        let selectedFolder = 'ì „ì²´';
        let selectedFiles = [];

        // ìƒíƒœ ìƒ‰ìƒ
        const statusColors = {
            "ê³„íš": "bg-yellow-100 text-yellow-800",
            "ì§„í–‰ì¤‘": "bg-blue-100 text-blue-800", 
            "ì™„ë£Œ": "bg-green-100 text-green-800",
            "ë³´ë¥˜": "bg-red-100 text-red-800"
        };

        // íŒŒì¼ íƒ€ì…ë³„ ì•„ì´ì½˜
        const fileIcons = {
            document: "ğŸ“„", image: "ğŸ–¼ï¸", spreadsheet: "ğŸ“Š",
            presentation: "ğŸ“½ï¸", archive: "ğŸ“¦", video: "ğŸ¬",
            audio: "ğŸµ", default: "ğŸ“"
        };

        // LocalStorage ê´€ë¦¬
        function saveToStorage() {
            try {
                localStorage.setItem('projectManagementData', JSON.stringify(projects));
                updateStorageInfo();
            } catch (e) {
                console.error('ì €ì¥ ì‹¤íŒ¨:', e);
                alert('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function loadFromStorage() {
            try {
                const data = localStorage.getItem('projectManagementData');
                if (data) {
                    projects = JSON.parse(data);
                } else {
                    // ì´ˆê¸° ìƒ˜í”Œ ë°ì´í„°
                    projects = [
                        {
                            id: 1,
                            name: "ì›¹ì‚¬ì´íŠ¸ ë¦¬ë‰´ì–¼",
                            category: "ì†”ë£¨ì…˜",
                            startDate: "2025-08-01",
                            endDate: "2025-10-31",
                            status: "ì§„í–‰ì¤‘",
                            progress: 65,
                            description: "íšŒì‚¬ ì›¹ì‚¬ì´íŠ¸ ì „ë©´ ë¦¬ë‰´ì–¼",
                            files: []
                        }
                    ];
                    saveToStorage();
                }
                updateStorageInfo();
            } catch (e) {
                console.error('ë¡œë“œ ì‹¤íŒ¨:', e);
                projects = [];
            }
        }

        function updateStorageInfo() {
            const dataSize = new Blob([JSON.stringify(projects)]).size;
            const sizeText = dataSize < 1024 ? `${dataSize}B` : 
                           dataSize < 1024*1024 ? `${(dataSize/1024).toFixed(1)}KB` :
                           `${(dataSize/1024/1024).toFixed(1)}MB`;
            document.getElementById('storageInfo').textContent = sizeText;
        }

        // íŒŒì¼ ê´€ë¦¬
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function getFileTypeFromName(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            const typeMap = {
                'pdf': 'document', 'doc': 'document', 'docx': 'document', 'txt': 'document',
                'jpg': 'image', 'jpeg': 'image', 'png': 'image', 'gif': 'image', 'svg': 'image', 'webp': 'image',
                'xls': 'spreadsheet', 'xlsx': 'spreadsheet', 'csv': 'spreadsheet',
                'ppt': 'presentation', 'pptx': 'presentation',
                'zip': 'archive', 'rar': 'archive', '7z': 'archive',
                'mp4': 'video', 'avi': 'video', 'mov': 'video',
                'mp3': 'audio', 'wav': 'audio', 'flac': 'audio'
            };
            return typeMap[extension] || 'default';
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            initializeEventListeners();
            renderDashboard();
            renderProjectsList();
            updateCharts();
        });

        function initializeEventListeners() {
            // ë·° ì „í™˜
            document.getElementById('dashboardBtn').addEventListener('click', () => switchView('dashboard'));
            document.getElementById('projectsBtn').addEventListener('click', () => switchView('projects'));

            // ë°ì´í„° ê´€ë¦¬
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importFile').click());
            document.getElementById('importFile').addEventListener('change', importData);

            // ì›”/ë…„ ì„ íƒ
            document.getElementById('monthSelect').addEventListener('change', (e) => {
                selectedMonth = parseInt(e.target.value);
                renderDashboard();
                updateCharts();
            });
            document.getElementById('yearSelect').addEventListener('change', (e) => {
                selectedYear = parseInt(e.target.value);
                renderDashboard();
                updateCharts();
            });

            // í”„ë¡œì íŠ¸ ëª¨ë‹¬
            document.getElementById('addProjectBtn').addEventListener('click', () => openProjectModal());
            document.getElementById('cancelBtn').addEventListener('click', () => closeProjectModal());
            document.getElementById('saveBtn').addEventListener('click', () => saveProject());
            document.getElementById('projectProgress').addEventListener('input', (e) => {
                document.getElementById('progressValue').textContent = e.target.value;
            });

            // íŒŒì¼ ëª¨ë‹¬
            document.getElementById('closeFileModal').addEventListener('click', () => closeFileModal());
            document.getElementById('closeFileModalBtn').addEventListener('click', () => closeFileModal());
            
            // íŒŒì¼ ì—…ë¡œë“œ
            const fileDropZone = document.getElementById('fileDropZone');
            const fileInput = document.getElementById('fileInput');
            
            fileDropZone.addEventListener('click', () => fileInput.click());
            fileDropZone.addEventListener('dragover', handleDragOver);
            fileDropZone.addEventListener('dragleave', handleDragLeave);
            fileDropZone.addEventListener('drop', handleFileDrop);
            
            fileInput.addEventListener('change', handleFileSelect);
            document.getElementById('uploadBtn').addEventListener('click', uploadFiles);
        }

        function exportData() {
            const dataStr = JSON.stringify(projects, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `í”„ë¡œì íŠ¸ê´€ë¦¬_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (confirm('í˜„ì¬ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        projects = importedData;
                        saveToStorage();
                        renderDashboard();
                        renderProjectsList();
                        updateCharts();
                        alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            selectedFiles = files;
            updateFileUploadUI();
        }

        function handleFileSelect(e) {
            selectedFiles = Array.from(e.target.files);
            updateFileUploadUI();
        }

        function updateFileUploadUI() {
            const uploadBtn = document.getElementById('uploadBtn');
            if (selectedFiles.length > 0) {
                uploadBtn.disabled = false;
                uploadBtn.textContent = `ğŸ“¤ ${selectedFiles.length}ê°œ íŒŒì¼ ì—…ë¡œë“œ`;
            } else {
                uploadBtn.disabled = true;
                uploadBtn.textContent = 'ğŸ“¤ ì—…ë¡œë“œ';
            }
        }

        async function uploadFiles() {
            if (selectedFiles.length === 0) return;

            const folder = document.getElementById('uploadFileFolder').value;
            const uploadBtn = document.getElementById('uploadBtn');
            
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';

            try {
                for (const file of selectedFiles) {
                    // íŒŒì¼ í¬ê¸° ì œí•œ (10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert(`${file.name}: íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                        continue;
                    }

                    const base64Data = await readFileAsBase64(file);
                    const newFile = {
                        id: Date.now() + Math.random(),
                        name: file.name,
                        type: getFileTypeFromName(file.name),
                        size: file.size,
                        uploadDate: new Date().toISOString().split('T')[0],
                        folder: folder,
                        data: base64Data
                    };

                    if (!selectedProject.files) {
                        selectedProject.files = [];
                    }
                    selectedProject.files.push(newFile);
                }

                // í”„ë¡œì íŠ¸ ë°°ì—´ ì—…ë°ì´íŠ¸
                const projectIndex = projects.findIndex(p => p.id === selectedProject.id);
                projects[projectIndex] = selectedProject;
                
                saveToStorage();
                selectedFiles = [];
                document.getElementById('fileInput').value = '';
                updateFileUploadUI();
                renderFolderFilters();
                renderFileList();
                renderProjectsList();
                
                alert('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ğŸ“¤ ì—…ë¡œë“œ';
            }
        }

        function downloadFile(fileId) {
            const file = selectedProject.files.find(f => f.id === fileId);
            if (!file || !file.data) {
                alert('íŒŒì¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                const link = document.createElement('a');
                link.href = file.data;
                link.download = file.name;
                link.click();
            } catch (error) {
                console.error('ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('íŒŒì¼ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function switchView(view) {
            currentView = view;
            
            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.remove('hidden');
                document.getElementById('projectsView').classList.add('hidden');
                document.getElementById('dashboardBtn').className = 'flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white';
                document.getElementById('projectsBtn').className = 'flex items-center px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200';
            } else {
                document.getElementById('dashboardView').classList.add('hidden');
                document.getElementById('projectsView').classList.remove('hidden');
                document.getElementById('dashboardBtn').className = 'flex items-center px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200';
                document.getElementById('projectsBtn').className = 'flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white';
            }
        }

        function getMonthlyProjects() {
            return projects.filter(project => {
                const startDate = new Date(project.startDate);
                const endDate = new Date(project.endDate);
                const targetDate = new Date(selectedYear, selectedMonth, 1);
                
                return (startDate <= targetDate && endDate >= targetDate) ||
                       (startDate.getMonth() === selectedMonth && startDate.getFullYear() === selectedYear);
            });
        }

        function renderDashboard() {
            const monthlyProjects = getMonthlyProjects();
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('totalProjects').textContent = monthlyProjects.length;
            document.getElementById('completedProjects').textContent = monthlyProjects.filter(p => p.status === 'ì™„ë£Œ').length;
            document.getElementById('inProgressProjects').textContent = monthlyProjects.filter(p => p.status === 'ì§„í–‰ì¤‘').length;
            
            const avgProgress = monthlyProjects.length > 0 
                ? Math.round(monthlyProjects.reduce((sum, p) => sum + p.progress, 0) / monthlyProjects.length)
                : 0;
            document.getElementById('avgProgress').textContent = avgProgress + '%';

            // ì´ íŒŒì¼ ìˆ˜
            const totalFiles = projects.reduce((sum, p) => sum + (p.files ? p.files.length : 0), 0);
            document.getElementById('totalFiles').textContent = totalFiles;

            // ì§„í–‰ë„ ëª©ë¡
            const progressList = document.getElementById('progressList');
            progressList.innerHTML = '';
            
            monthlyProjects.forEach(project => {
                const projectDiv = document.createElement('div');
                projectDiv.className = 'border rounded-lg p-4';
                projectDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-medium text-gray-900">${project.name}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[project.status]}">${project.status}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: ${project.progress}%"></div>
                        </div>
                        <span class="text-sm text-gray-600">${project.progress}%</span>
                    </div>
                `;
                progressList.appendChild(projectDiv);
            });
        }

        function renderProjectsList() {
            const tbody = document.getElementById('projectsTableBody');
            tbody.innerHTML = '';
            
            projects.forEach(project => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div>
                            <div class="text-sm font-medium text-gray-900">${project.name}</div>
                            <div class="text-sm text-gray-500">${project.description}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${project.category}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[project.status]}">${project.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${project.progress}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${project.progress}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${project.startDate} ~ ${project.endDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center text-sm text-gray-900">
                            ğŸ“ ${project.files ? project.files.length : 0}ê°œ
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="editProject(${project.id})" class="text-blue-600 hover:text-blue-900" title="í¸ì§‘">âœï¸</button>
                            <button onclick="openFileManager(${project.id})" class="text-green-600 hover:text-green-900" title="íŒŒì¼ê´€ë¦¬">ğŸ“</button>
                            <button onclick="deleteProject(${project.id})" class="text-red-600 hover:text-red-900" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateCharts() {
            const monthlyProjects = getMonthlyProjects();
            
            // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
            const categoryStats = ["ì†”ë£¨ì…˜", "ì»¨ì„¤íŒ…", "ê°•ì˜", "ê¸°íƒ€"].map(cat => ({
                name: cat,
                count: monthlyProjects.filter(p => p.category === cat).length
            }));

            // ìƒíƒœë³„ í†µê³„
            const statusStats = ["ê³„íš", "ì§„í–‰ì¤‘", "ì™„ë£Œ", "ë³´ë¥˜"].map(status => ({
                name: status,
                count: monthlyProjects.filter(p => p.status === status).length
            }));

            // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ
            Chart.getChart('categoryChart')?.destroy();
            Chart.getChart('statusChart')?.destroy();

            // ì¹´í…Œê³ ë¦¬ ì°¨íŠ¸
            new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: categoryStats.map(s => s.name),
                    datasets: [{
                        data: categoryStats.map(s => s.count),
                        backgroundColor: ['#8884d8', '#82ca9d', '#ffc658', '#ff7300']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // ìƒíƒœ ì°¨íŠ¸
            new Chart(document.getElementById('statusChart'), {
                type: 'bar',
                data: {
                    labels: statusStats.map(s => s.name),
                    datasets: [{
                        data: statusStats.map(s => s.count),
                        backgroundColor: '#8884d8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function openProjectModal(project = null) {
            editingProject = project;
            const modal = document.getElementById('projectModal');
            const title = document.getElementById('modalTitle');
            
            if (project) {
                title.textContent = 'í”„ë¡œì íŠ¸ í¸ì§‘';
                document.getElementById('projectName').value = project.name;
                document.getElementById('projectCategory').value = project.category;
                document.getElementById('projectStatus').value = project.status;
                document.getElementById('projectProgress').value = project.progress;
                document.getElementById('progressValue').textContent = project.progress;
                document.getElementById('projectStartDate').value = project.startDate;
                document.getElementById('projectEndDate').value = project.endDate;
                document.getElementById('projectDescription').value = project.description;
            } else {
                title.textContent = 'ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€';
                document.getElementById('projectName').value = '';
                document.getElementById('projectCategory').value = 'ì†”ë£¨ì…˜';
                document.getElementById('projectStatus').value = 'ê³„íš';
                document.getElementById('projectProgress').value = 0;
                document.getElementById('progressValue').textContent = '0';
                document.getElementById('projectStartDate').value = '';
                document.getElementById('projectEndDate').value = '';
                document.getElementById('projectDescription').value = '';
            }
            
            modal.classList.remove('hidden');
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.add('hidden');
            editingProject = null;
        }

        function saveProject() {
            const name = document.getElementById('projectName').value.trim();
            const startDate = document.getElementById('projectStartDate').value;
            const endDate = document.getElementById('projectEndDate').value;
            
            if (!name || !startDate || !endDate) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const projectData = {
                name: name,
                category: document.getElementById('projectCategory').value,
                status: document.getElementById('projectStatus').value,
                progress: parseInt(document.getElementById('projectProgress').value),
                startDate: startDate,
                endDate: endDate,
                description: document.getElementById('projectDescription').value,
                files: editingProject ? editingProject.files : []
            };

            if (editingProject) {
                const index = projects.findIndex(p => p.id === editingProject.id);
                projects[index] = { ...projectData, id: editingProject.id };
            } else {
                projects.push({ ...projectData, id: Date.now() });
            }

            saveToStorage();
            closeProjectModal();
            renderProjectsList();
            renderDashboard();
            updateCharts();
        }

        function editProject(id) {
            const project = projects.find(p => p.id === id);
            openProjectModal(project);
        }

        function deleteProject(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projects = projects.filter(p => p.id !== id);
                saveToStorage();
                renderProjectsList();
                renderDashboard();
                updateCharts();
            }
        }

        function openFileManager(projectId) {
            selectedProject = projects.find(p => p.id === projectId);
            selectedFolder = 'ì „ì²´';
            
            document.getElementById('fileModalTitle').textContent = `${selectedProject.name} - íŒŒì¼ ê´€ë¦¬`;
            document.getElementById('fileModal').classList.remove('hidden');
            
            renderFolderFilters();
            renderFileList();
        }

        function closeFileModal() {
            document.getElementById('fileModal').classList.add('hidden');
            selectedProject = null;
            selectedFolder = 'ì „ì²´';
            selectedFiles = [];
            updateFileUploadUI();
        }

        function renderFolderFilters() {
            const folders = getProjectFolders();
            const container = document.getElementById('folderFilters');
            container.innerHTML = '';
            
            folders.forEach(folder => {
                const button = document.createElement('button');
                button.className = `px-3 py-1 rounded-full text-sm font-medium ${
                    selectedFolder === folder 
                        ? 'bg-blue-600 text-white' 
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`;
                button.textContent = `ğŸ“ ${folder}`;
                button.addEventListener('click', () => {
                    selectedFolder = folder;
                    renderFolderFilters();
                    renderFileList();
                });
                container.appendChild(button);
            });
        }

        function getProjectFolders() {
            if (!selectedProject.files) return ['ì „ì²´'];
            const folders = [...new Set(selectedProject.files.map(f => f.folder))];
            return ['ì „ì²´', ...folders];
        }

        function getFilteredFiles() {
            if (!selectedProject?.files) return [];
            if (selectedFolder === 'ì „ì²´') return selectedProject.files;
            return selectedProject.files.filter(f => f.folder === selectedFolder);
        }

        function renderFileList() {
            const files = getFilteredFiles();
            const container = document.getElementById('fileList');
            const countElement = document.getElementById('fileCount');
            const sizeElement = document.getElementById('totalFileSize');
            
            countElement.textContent = files.length;
            
            const totalSize = files.reduce((sum, file) => sum + (file.size || 0), 0);
            sizeElement.textContent = formatFileSize(totalSize);
            
            container.innerHTML = '';
            
            if (files.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <div class="text-6xl mb-3">ğŸ“</div>
                        <p>íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            files.forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'px-4 py-3 hover:bg-gray-50';
                fileDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">${fileIcons[file.type] || fileIcons.default}</div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${file.name}</p>
                                <p class="text-xs text-gray-500">${formatFileSize(file.size || 0)} â€¢ ${file.uploadDate} â€¢ ${file.folder}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="downloadFile(${file.id})" class="text-blue-600 hover:text-blue-900" title="ë‹¤ìš´ë¡œë“œ">ğŸ’¾</button>
                            <button onclick="deleteFile(${file.id})" class="text-red-600 hover:text-red-900" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
                container.appendChild(fileDiv);
            });
        }

        function deleteFile(fileId) {
            if (confirm('íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                selectedProject.files = selectedProject.files.filter(f => f.id !== fileId);
                
                const projectIndex = projects.findIndex(p => p.id === selectedProject.id);
                projects[projectIndex] = selectedProject;
                
                saveToStorage();
                renderFileList();
                renderProjectsList();
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.editProject = editProject;
        window.deleteProject = deleteProject;
        window.openFileManager = openFileManager;
        window.downloadFile = downloadFile;
        window.deleteFile = deleteFile;
    </script>
</body>
</html>